apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ .Release.Name }}-cm"
  namespace: {{ .Release.Namespace }}
data:
  configuration.yml: |
    # config
    server:
      address: 'tcp://:9091/'
      disable_healthcheck: true
    authentication_backend:
      file:
        path: '/config/users_database.yml'
    access_control:
      default_policy: 'one_factor'
    identity_validation:
      reset_password:
        jwt_secret: 'a_very_important_secret'
    storage:
      encryption_key: {{`'{{- secret "/etc/authelia-secret/encryption_key" }}'`}}
      postgres:
        address: {{`'tcp://{{- secret "/etc/db-secret/host" }}:{{- secret "/etc/db-secret/port" }}`'}}
        database: {{`'{{- secret "/etc/db-secret/dbname" }}'`}}
        username: {{`'{{- secret "/etc/db-secret/username" }}'`}}
        password: {{`'{{- secret "/etc/db-secret/password" }}'`}}
    notifier:
      filesystem:
        filename: '/data/notification.txt'
    session:
      # This secret can also be set using the env variables AUTHELIA_SESSION_SECRET_FILE
      secret: 'insecure_session_secret'
      cookies:
        - name: 'authelia_session'
          domain: '{{ .Values.vadderung.baseDomain }}'
          authelia_url: 'https://authelia.{{ .Values.vadderung.baseDomain }}'
          expiration: '1 hour'
          inactivity: '5 minutes'

  users_database.yml: |
    # Temporary test user
    users:
      authelia:
        disabled: false
        displayname: 'Authelia User'
        # Password is authelia
        password: '$6$rounds=50000$BpLnfgDsc2WD8F2q$Zis.ixdg9s/UOJYrs56b5QEZFiZECu0qZVNsIYxBaNJ7ucIL.nlxVCT5tqh8KHG8X4tlwCFm5r6NTOZZ5qRFN/'  # yamllint disable-line rule:line-length
        email: 'authelia@authelia.com'
        groups:
          - 'admins'
          - 'dev'